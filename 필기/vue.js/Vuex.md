# Vuex



## 1. Vuex

- ### state Management

  - 상태(State)란 **현재에 대한 정보(data)**



- ### 상태 관리

  - 각 component는 독립적이기 때문에 각각의 상태(data)를 가진다.
  - **여러 개의 component가 같은 상태(data)를 유지할 필요가 있다.**



- ### Pass Props & Emit Event

  - 각 컴포넌트는 독립적으로 데이터를 관리
  - **같은 데이터를 공유하고 있으므로** 각 컴포넌트가 동일한 상태를 유지하고 있다.
  - component의 중첩이 깊어지면 데이터 전달이 쉽지 않다.



- ### Centralized Store

  - **중앙 저장소 (store)에 데이터를 모아서 상태 관리**
  - 각 component는 중앙 저장소의 데이터를 사용한다.
  - component의 계층에 상관없이 중앙 저장소에 접근해서 데이터를 얻거나 변경할 수 있다.



- ### Vuex

  - "state management pattern + Library" 
    - 생태 관리 패턴 + 라이브러리
  - **중앙 저장소를 통해 상태 관리를 할 수 있도록 하는 라이브러리**
  - 데이터가 예측 가능한 방식으로만 변경 될 수 있도록 하는 **규칙을 설정하며, Vue의 반응성을 효율적으로 사용하는 상태 관리 기능**을 제공
  - Vue의 공식 도구로써 다양한 기능을 제공한다.
  - ![화면 캡처 2022-11-07 102638](C:.\화면 캡처 2022-11-07 102638.png)



- ### Vuex 시작하기

  - ![화면 캡처 2022-11-07 102732](C:.\화면 캡처 2022-11-07 102732.png)



- ### 프로젝트 vuex

  - src / store / index.js가 생성된다.
  - vuex의 핵심 컨셉 4가지
    1. **state**
    2. **getters**
    3. **mutations**
    4. **actions**
  - ![화면 캡처 2022-11-07 102920](C:.\화면 캡처 2022-11-07 102920.png)
  - ![화면 캡처 2022-11-07 104406](C:.\화면 캡처 2022-11-07 104406.png)



- ### State

  - vue 인스턴스의 data에 해당한다.
  - **중앙에서 관리하는 모든 상태 정보**
  - 개별 component는 state에서 데이터를 가져와서 사용한다.
    - 개별 component가 관리하던 data를 중앙 저장소(Vuex Store의 state)에서 관리한다.
  - state의 데이터가 변화하면 해당 데이터를 사용(공유)하는 component도 자동으로 다시 렌더링
  - **$store.state**로 state 데이터에 접근



- ### Mutations

  - **실제로 state를 변경하는 유일한 방법**
  - vue 인스턴스의 methods에 해당하지만 Mutations에서 호출되는 핸들러(handler) 함수는 반드시 **동기적**이어야 한다.
    - **비동기 로직으로 mutations를 사용해서 state를 변경하는 경우, state의 변화의 시기를 특정할 수 없기 때문이다.**
  - 첫 번째 인자로 state를 받으며, component 혹은 Actions에서 **commit()** 메서드로 호출된다.
    - **mutation, action에서 호출되는 함수를 handler 함수라고 한다.**



- ### Actions

  - mutations와 비슷하지만 **비동기** 작업을 포함할 수 있다는 차이가 있다.
  - **state를 직접 변경하지 않고 commit()메서드로 mutations를 호출해서 state를 변경한다.**
  - context 객체를 인자로 받으며, 이 객체를 통해 store.js의 모든 요소와 메서드에 접근할 수 있다. (**state를 직접 변경할 수 있지만 하지 않아야 한다.**)
  - component에서 **dispatch()**메서드에 의해 호출된다.



- ### Mutations & Actions

  - ![화면 캡처 2022-11-07 103910](C:.\화면 캡처 2022-11-07 103910.png)



- ### Getters

  - vue 인스턴스의 computed에 해당
  - **state를 활용하여 계산된 값을 얻고자 할 때 사용한다.**
    - state의 원본 데이터를 건들지 않고 계산된 값을 얻을 수 있다.
  - computed와 마찬가지로 getters의 결과는 캐시(cache) 되며, 종속된 값이 변경된 경우에만 재계산된다.
  - **getters에서 계산된 값은 state에 영향을 미치지 않는다.**
  - 첫 번째 인자로 **state**, 두 번째 인자로 **getter**를 받는다.



- ### 데이터 관리

  - Vuex를 사용한다고 해서 모든 데이터를 state에 넣어야 하는 것은 아니다
  - Vuex에서도 여전히 pass props, emit event를 사용하여 상태를 관리할 수 있다.



- ### 정리

  - ![화면 캡처 2022-11-07 104253](C:.\화면 캡처 2022-11-07 104253.png)
  - ![화면 캡처 2022-11-07 104317](C:.\화면 캡처 2022-11-07 104317.png)



- ### 실습

  - **객체 메서드는 축약형을 사용**
    - ![화면 캡처 2022-11-07 104520](C:.\화면 캡처 2022-11-07 104520.png)

  

  - **State**
    - **$store.state**로 바로 접근하기 보다 **computed**에 정의 후 접근하는 것을 권장한다.
      - ![화면 캡처 2022-11-07 104817](C:.\화면 캡처 2022-11-07 104817.png)
      - Vue 개발자 도구의 Vuex에서 관리 되고 있는 state 확인 가능하다.

  

  - **Actions**

    - state를 변경할 수 있는 **Mutations 호출**
    - component에서 **dispatch()에 의해 호출된다.**
    - **dispatch(A, B)**
      - A : 호출하고자 하는 actions 함수
      - B : 넘겨주는 데이터(payload)
    - ![화면 캡처 2022-11-07 105331](C:.\화면 캡처 2022-11-07 105331.png)
      - **actions의 첫 번째 인자는 context**
        - **context는 store의 전반적인 속성을 모두 가지고 있으므로** context.state와 context.getters를 통해 mutations를 호출하는 것이 모두 가능하다.
        - dispatch()를 사용해 다른 actions도 호출할 수 있다.
        - **actions에서 state를 직접 조작하는 것은 삼가야 한다.**
      - **actions의 두 번째 인자는 payload**
        - 넘겨준 데이터를 받아서 사용한다.

    

    - ![화면 캡처 2022-11-07 105304](C:.\화면 캡처 2022-11-07 105304.png)

  

  - **Mutations**
    - state를 변경하는 유일한 방법
    - component 또는 actions에서 **commit()에 의해 호출된다.**
    - **commit(A, B)**
      - A : 호출하고자 하는 mutations 함수
      - B : payload
    - ![화면 캡처 2022-11-07 110011](C:.\화면 캡처 2022-11-07 110011.png)
    - ![화면 캡처 2022-11-07 105732](C:.\화면 캡처 2022-11-07 105732.png)

  

  - **Getters**

    - **getters는 state를 활용한 새로운 변수**
      - 첫 번째 인자 : state
      - 두 번째 인자 : getters
    - ![화면 캡처 2022-11-07 110208](C:.\화면 캡처 2022-11-07 110208.png)

    

    - getters의 다른 함수 사용
      - ![화면 캡처 2022-11-07 110404](C:.\화면 캡처 2022-11-07 110404.png)

    

    - getters도 state와 마찬가지로  computed에 정의해서 사용하는 것을 권장한다.
      - ![화면 캡처 2022-11-07 110927](C:.\화면 캡처 2022-11-07 110927.png)

---



## 2. Lifecycle Hooks



- ### Lifecycle Hooks

  - 각 vue 인스턴스는 생성과 소멸의 과정 중 단계별 초기화 과정을 거친다.
  - 각 단계가 트리거가 되어 특정 로직을 실행할 수 있다.
  - ![화면 캡처 2022-11-07 112652](C:.\화면 캡처 2022-11-07 112652.png)



- ### beforeCreate

  - Vue 인스턴스가 초기화 된 직후에 발생
  - 컴포넌트가 DOM에 추가되기 전이라 this.$el, data, methods에 접근할 수 없다.



- ### created

  - Vue instance가 생성된 후 호출된다.
  - data, computed 등의 설정이 완료된 상태
  - 서버에서 받은 데이터를 vue instance의 data에 할당하는 로직을 구현하기 적합하다.
  - **mount되지 않아 요소에 접근할 수 없다.**
    - DOM에 추가된 상태가 아니다.
  - ![화면 캡처 2022-11-07 114353](C:.\화면 캡처 2022-11-07 114353.png)
    - created 함수를 이용해 버튼을 누르지 않아도 강아지 사진을 가져오는 함수를 추가



- ### beforeMount

  - DOM에 부착하기 직전에 호출
  - 가상 DOM이 생성되어 있으나 실제 DOM에 부착되지는 않은 상태



- ### mounted

  - Vue instance가 요소에 mount된 후 호출된다.
  - mount된 요소를 조작할 수 있다.
  - ![화면 캡처 2022-11-07 114528](C:.\화면 캡처 2022-11-07 114528.png)



- ### beforeUpdate

  - data의 값이 변해 DOM에도 그 변화가 있을 때 변화 직전에 호출된다.
  - 변할 값을 이용해 가상 DOM을 렌더링하기 전이지만, 이 값을 이용해 작업할 수는 있다.
  - 값들을 추가적으로 변화시키더라도 랜더링을 추가로 호출하지 않는다.



- ### updated

  - 데이터가 변경되어 DOM에 변화를 줄 때 호출된다.
  - 변경된 data가 DOM에도 적용된 상태
  - 변경된 값들을 DOM을 이용해 접근하고 싶을 때 사용
  - **data를 변경하는 것은 무한 루프를 일으킬 수 있으니 데이터를 직접 바꾸어서는 안된다.**
  - ![화면 캡처 2022-11-07 114631](C:.\화면 캡처 2022-11-07 114631.png)



- ###  beforeDestroy

  - 해당 인스턴스가 해체되기 직전에 호출된다.
  - 해체되기 이전이므로 모든 속성에 접근이 가능하다.
  - **인스턴스가 사라지기 전에 해야할 일들을 처리**



- ### destroyed

  - 인스턴스가 해체되고 난 직후에 호출된다.
  - 해체가 끝난 이후라 인스턴스 속성에 접근할 수 없다.
  - 하위 Vue 인스턴스 역시 삭제된다.



- ### Lifecycle Hooks 특징

  - instance마다 각각의 Lifecycle을 가지고 있다.

    - 부모 컴포넌트의 mounted hook이 실행 되었다고 해서 자식이 mount 된 것이 아니고 그 반대도 아니다.

  - Lifecycle Hooks는 컴포넌트 별로 정의할 수 있다.

  - **this.$nextTick**

    - 모든 화면이 렌더링 된 이후에 실행하게 하여 마운트 상태를 보장할 수 있다.
    - ![화면 캡처 2022-11-07 115333](C:.\화면 캡처 2022-11-07 115333.png)


---



## 3. Local Storage

- ###  Window.localStorage

  - 브라우저에서 제공하는 저장공간 중 하나인 Local Storage에 관련된 속성
  - 만료되지 않고 브라우저를 종료하고 다시 실행해도 데이터가 보존된다.
  - 데이터가 문자열 형태로 저장된다.
  - **관련 메서드**
    - **setItem(key, value) - key, value 형태로 데이터 저장**
    - **getItem(key) - key에 해당하는 데이터 조회**
      - key 값은 어떤 이름이든 상관없다.



- ### Local Storage 실습

  - todos 배열을 Local Storage에 저장하기
  - 데이터가 문자열 형태로 저장되어야 하기 때문에 **JSON.stringify를 사용해 문자열로 변환해주는 과정**이 필요하다.
  - state를 변경하는 작업이 아니기 때문에 mutations가 아닌 actions에 작성한다
  - ![화면 캡처 2022-11-07 163355](C:.\화면 캡처 2022-11-07 163355.png)

  

  - todo 생성, 삭제, 수정시에 모두 saveTodosToLocalStorage action 메서드가 실행 되도록 한다.
    - ![화면 캡처 2022-11-07 163919](C:.\화면 캡처 2022-11-07 163919.png)

  

  - 개발자 도구 => Application => Storage => Local Storage에서 확인 가능하다.

  - **Local Storage에 있는 todo 목록을 불러오는 것이 아니기 때문에 새로고침 이후 모두 사라진다. **
  - **우리는 불러오기 버튼을 누르면 Local Storage에 저장된 데이터를 가져오게 한다.**
    1. 불러오기 버튼 작성
       - ![화면 캡처 2022-11-07 165029](C:.\화면 캡처 2022-11-07 165029.png)
    2. loadTodos 메서드 작성
       - ![화면 캡처 2022-11-07 165059](C:.\화면 캡처 2022-11-07 165059.png)
    3. loadTodos action 메서드 작성
       - ![화면 캡처 2022-11-07 165118](C:.\화면 캡처 2022-11-07 165118.png)
    4. LOAD_TODOS mutation 메서드 작성
       - **문자열 데이터를 다시 object 타입으로 변환(JSON.parse)하여 저장**
       - ![화면 캡처 2022-11-07 165200](C:.\화면 캡처 2022-11-07 165200.png)



- ### vuex-persistedstate

  - Vuex state를 자동으로 브라우저의 Local Storage에 저장해주는 라이브러리 중 하나
  - 페이지가 새로고침 되어도 Vuex state를 유지시킨다.
  - Local Storage에 저장된 data를 자동으로 state로 불러온다.

  

  - **설치**
    - ![화면 캡처 2022-11-07 165406](C:.\화면 캡처 2022-11-07 165406.png)
  - **적용**
    - ![화면 캡처 2022-11-07 165431](C:.\화면 캡처 2022-11-07 165431.png)
